# Hitomi Copy 개발문서

## 다운로드 관련

`HitomiQueue.cs`파일은 히토미 작품 다운로드를 위한 Class이다.
여기서 Thread 수를 조정하 수 있고, C#의 초기 설정인 접속수를 설정할 수 있다.
이 클래스는 다른 어떤 클래스하고도 의존, 연관성이 없으므로, 다른 프로젝트에 이름만 바꾸어 사용하 수 있을 것이다.

쓰레드 수를 조절하는 정통적인 방법은 코어수를 가져오는 것이지만, 그건 속도가 빠르고, 대기시간이 거의 없으며, 용량이 큰 파일을 다운로드할 때의 이야기이고,
히토미 같이 속도가 느리고, 대기시간이 길며, 용량이 작은 파일을 다운로드 할때는 쓰레드 숫자를 늘려주는 것이 좋을 것이다.
`i7 8700k`를 기준으로 128쓰레드가 적당한 수치로 보인다.

## 추천작가 시스템

관심없는 작가일 경우 추천작가 목록에 안보여주는 편이 좋다.
다운로드 로그를 분석하여 작가의 다운로드 작품수를 가져오고 그 비율을 점수로 나눠 표기할 계획이다.
이는 사용자에 취향뿐만아니라 관심에 맞는 추천작가를 상위에 노출시키기 위한 계획이다.

## Forbidden 이슈

403에러는 `galleries/*.html`중 gallery데이터가 삭제되었을때 나타난다. 
Json에도 없어 검색이 불가능하고, 유일한 접근 경로는 다른 갤러리와의 연관 목록이다.
시도해볼만한 방법은 E-Hentai목록을 모두 파싱하여 정보를 재결합하는 것이다.

이렇게 얻은 정보는 `galleries/*.js`에서 썸네일 정보와 이미지 정보를 얻고, 기존의 방법으로 다운로드 한다.

## HitomiQueue Abort 함수

`DownloadRemoteImageFile`함수에서 `HttpWebRequest`를 Abort할 시 callback이 한 번 이상 호출될 수 있음을 확인했다.
이 오류는 pbTarget Value에 영향을 주므로, 일단, pbTarget의 Maximum보다 높게 Value를 올릴 수 없게 수정했다.

## Ex-Hentai 다운로더

이 사이트를 이용하기 위해선 기본적으로 ex-hentai에 접속할 수 있는 쿠키가 필요하다.
적절한 쿠키를 먹여주면 사이트 접속이 가능하고, HtmlAgilityPack으로 분석하기 쉬운 구조이다.

## Pixiv 다운로더

Pixeez라이브러리를 이용해 분석할 계획이다.

## Twitter 다운로더

곧 추가할 계획이다.
잘 모르겠다 ;;

## 통합

Hitomi Downloader를 제외한 나머지 Ex-Hentai, Pixiv, Twitter를 통합할 계획이다.